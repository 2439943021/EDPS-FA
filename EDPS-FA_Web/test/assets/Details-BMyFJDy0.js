import{b as U,c as q,u as O,d as R,e as g,f as J,h as K,i as $,_ as z}from"./index-DNppxucq.js";const H={"element-loading-text":"Loading...",style:{height:"1000px"}},A=["src"],W={class:"button_center"},X={class:"button_center"},Y={style:{"text-align":"right"}},j=Vue.defineComponent({__name:"Details",setup(G){let y=localStorage.getItem("lang");const{t:n}=U();q();const r=JSON.parse(localStorage.getItem("user")||"{}").id;let l=Vue.reactive({}),h=Vue.ref("");const V=Vue.ref(null);let C=Vue.ref(),u=Vue.ref(!1),c=Vue.ref(!1);const f=Vue.ref("Default System Favorites");let i=Vue.ref();const m=Vue.ref({addFolderName:""}),v=Vue.ref(""),p=O(),N=Vue.ref(!0),k={addFolderName:[{required:!0,message:n("messages.createFavoritesTips"),trigger:"blur"}]},b=async e=>{var t;if(console.log("Received message:",e.data),l={...e.data},l.hasOwnProperty("isCollected"))if(l.isCollected){u.value=!0;const s=await g(r);i.value=s.data}else J(r,v.value,l.paragraphId,l.collectType).then(()=>{ElementPlus.ElMessage.success(n("messages.mes_fav_quit_collect"))}).catch(()=>{ElementPlus.ElMessage.error(n("messages.mes_fav_quit_collect_err"))});else if(l.collectType==="manu"){const s=document.getElementById("toolbar");s&&document.body.removeChild(s);const o=document.createElement("div");o.id="toolbar",o.style.position="absolute",o.style.background="#F56C6C",o.style.border="1px solid #ccc",o.style.padding="5px",o.style.borderRadius="5px",o.style.left=`${l.mouseX}px`,o.style.top=`${l.mouseY+150}px`,Vue.watchEffect(()=>{y=localStorage.getItem("lang"),y==="zh"?o.innerHTML='<el-button id="collect-btn" type="primary">收藏</el-button>':o.innerHTML='<el-button id="collect-btn" type="primary">Collect</el-button>'}),document.body.appendChild(o),(t=document.getElementById("collect-btn"))==null||t.addEventListener("click",function(){T(),document.body.removeChild(o)}),setTimeout(()=>{document.body.contains(o)&&document.body.removeChild(o)},1500);const d=()=>{document.body.contains(o)&&document.body.removeChild(o),document.removeEventListener("click",d),document.removeEventListener("wheel",d)};document.addEventListener("click",d),document.addEventListener("wheel",d)}},T=async()=>{u.value=!0;const e=await g(r);i.value=e.data},w=()=>{var t;const e=(t=i.value.find(s=>f.value===s.className))==null?void 0:t.classId;l.collectType=l.collectType==="manu"?"选中":"段落",K(e,r,v.value,l.content,l.paragraphId,JSON.stringify(l.entities),l.collectType).then(()=>{ElementPlus.ElMessage.success(n("messages.mes_fav_collect_suc"))}).catch(()=>{ElementPlus.ElMessage.error(n("messages.mes_fav_collect_suc_err"))}),u.value=!1},S=e=>{c.value=!0,e.currentTarget.blur()},E=Vue.ref(null),x=()=>{var e;(e=E.value)==null||e.validate(async t=>{if(t)try{if((await $(m.value.addFolderName,r)).code===500)ElementPlus.ElMessage.error(n("messages.mes_fav_repeat"));else{ElementPlus.ElMessage.success(n("messages.mes_fav_add")),f.value=m.value.addFolderName;const o=await g(r);i.value=o.data,c.value=!1}}catch{ElementPlus.ElMessage.error(n("messages.mes_fav_again_collect"))}else return console.log("表单验证失败"),!1})};return Vue.ref(""),Vue.onMounted(async()=>{v.value=p.query.articleId?JSON.parse(p.query.articleId):"";try{const e=await R(r,v.value);C.value=e.data}catch(e){console.error("获取 collectedIds 失败:",e)}h.value=p.query.url?JSON.parse(p.query.url):"",N.value=!1,V.value&&(V.value.onload=()=>{var e;try{const t=JSON.parse(JSON.stringify({collectedIds:C.value}));(e=V.value.contentWindow)==null||e.postMessage(t,"*")}catch(t){console.error("serializedData数组不可序列化!",t)}}),window.addEventListener("message",b)}),Vue.onBeforeUnmount(()=>{window.removeEventListener("message",b)}),(e,t)=>{const s=Vue.resolveComponent("el-option"),o=Vue.resolveComponent("el-select"),d=Vue.resolveComponent("el-form-item"),F=Vue.resolveComponent("el-form"),B=Vue.resolveComponent("Plus"),M=Vue.resolveComponent("el-icon"),_=Vue.resolveComponent("el-button"),L=Vue.resolveComponent("el-divider"),I=Vue.resolveComponent("el-dialog"),P=Vue.resolveComponent("el-input"),D=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.withDirectives((Vue.openBlock(),Vue.createElementBlock("div",H,[Vue.createElementVNode("iframe",{ref_key:"iframe",ref:V,id:"reportiframe",src:Vue.unref(h),width:"100%",style:{height:"100%"},frameborder:"0"},null,8,A)])),[[D,N.value]]),Vue.createVNode(I,{modelValue:Vue.unref(u),"onUpdate:modelValue":t[1]||(t[1]=a=>Vue.isRef(u)?u.value=a:u=a),width:"500",title:e.$t("messages.addToFavorites"),"append-to-body":"","destroy-on-close":"",center:"",onKeyup:Vue.withKeys(w,["enter"])},{default:Vue.withCtx(()=>[Vue.createVNode(F,null,{default:Vue.withCtx(()=>[Vue.createVNode(d,null,{default:Vue.withCtx(()=>[Vue.createVNode(o,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=a=>f.value=a),placeholder:"Select",size:"large",style:{width:"200px"}},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(i),a=>(Vue.openBlock(),Vue.createBlock(s,{key:a.classId,value:a.className,label:a.className},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),Vue.createElementVNode("div",W,[Vue.createVNode(_,{onClick:S},{default:Vue.withCtx(()=>[Vue.createVNode(M,null,{default:Vue.withCtx(()=>[Vue.createVNode(B)]),_:1}),Vue.createTextVNode(" "+Vue.toDisplayString(e.$t("messages.newFavorites")),1)]),_:1})]),Vue.createVNode(L),Vue.createElementVNode("div",X,[Vue.createVNode(_,{ref:"collectButton",onClick:w},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(e.$t("messages.button_collect")),1)]),_:1},512)])]),_:1},8,["modelValue","title"]),Vue.createVNode(I,{title:e.$t("messages.newFavorites"),modelValue:Vue.unref(c),"onUpdate:modelValue":t[4]||(t[4]=a=>Vue.isRef(c)?c.value=a:c=a),width:"400",onKeyup:Vue.withKeys(x,["enter"])},{default:Vue.withCtx(()=>[Vue.createVNode(F,{model:m.value,rules:k,ref_key:"formRef",ref:E},{default:Vue.withCtx(()=>[Vue.createVNode(d,{label:e.$t("messages.favorites"),prop:"addFolderName"},{default:Vue.withCtx(()=>[Vue.createVNode(P,{modelValue:m.value.addFolderName,"onUpdate:modelValue":t[2]||(t[2]=a=>m.value.addFolderName=a),onKeydown:t[3]||(t[3]=Vue.withKeys(Vue.withModifiers(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),Vue.createElementVNode("div",Y,[Vue.createVNode(_,{onClick:x},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(e.$t("messages.button_add")),1)]),_:1})])]),_:1},8,["title","modelValue"])],64)}}}),Z=z(j,[["__scopeId","data-v-9e127536"]]);export{Z as default};
